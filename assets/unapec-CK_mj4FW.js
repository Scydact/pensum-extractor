import{y as S,z as F}from"./index-MonfMq5o.js";async function j(a,r="https://servicios.unapec.edu.do/pensum/Main/Detalles/"){let t=r+a;const n=JSON.parse(localStorage.getItem("PENSUM_CORSPROXY")??'""');n&&(t=n+t),console.log("Fetching URL ",t);const c=await fetch(t,{cache:"force-cache"}).then(l=>l.text());if(!c)return null;const i=new DOMParser().parseFromString(c,"text/xml");return O(i,t)}function O(a,r){try{const t=R(a),n=S(t,"unapec");return n.fetchDate=F(new Date),n.src={type:"online",date:n.fetchDate,url:r},n}catch(t){return console.error(t),null}}function R(a){var g,i,p,l,d,C,w,x,E,y,P,b,U,N,D;const r={carrera:"",codigo:"",vigencia:"",infoCarrera:[],cuats:[],version:2};if(a.getElementsByClassName("contPensum").length===0||a.getElementsByClassName("contPensum")[0].children.length<2)throw new Error("Document has no pensum inside!");const t=a.getElementsByClassName("cabPensum")[0];if(!t)throw new Error("Unable to get table element.");r.carrera=((i=(g=t==null?void 0:t.firstElementChild)==null?void 0:g.textContent)==null?void 0:i.trim())||"";const n=t.getElementsByTagName("p")[0].children;if(r.codigo=((l=(p=n[0])==null?void 0:p.textContent)==null?void 0:l.trim())||"",r.vigencia=((C=(d=n[1])==null?void 0:d.textContent)==null?void 0:C.trim())||"",r.carrera==="")throw new Error("Unable to get pensum name");if(r.codigo==="")throw new Error("Unable to get pensum code");const m=a.getElementsByClassName("infoCarrera")[0].children;for(let o=0;o<m.length;++o)r.infoCarrera.push(((E=(x=(w=m[o])==null?void 0:w.textContent)==null?void 0:x.replace(/\n/g," "))==null?void 0:E.trim())||"");const c=a.getElementsByClassName("cuatrim");for(let o=0;o<c.length;++o){const $=c[o].children,B=[];for(let h=1;h<$.length;++h){const e={codigo:"",asignatura:"",creditos:0},q=[],v=[];e.prereq=q,e.prereqExtra=v;const u=$[h].children;if(e.codigo=((P=(y=u[0])==null?void 0:y.textContent)==null?void 0:P.trim())||"",e.asignatura=((U=(b=u[1])==null?void 0:b.textContent)==null?void 0:U.trim())||"",e.creditos=parseFloat(((N=u[2])==null?void 0:N.textContent)||"-Infinity"),e.codigo==="")throw new Error(`Unable to get code for mat ${e.asignatura} @ cuat ${o+1}`);if(e.asignatura==="")throw new Error(`Unable to get name for mat ${e.codigo} @ cuat ${o+1}`);if(e.creditos===-1/0)throw new Error(`Unable to get creds for mat ${e.codigo}:${e.asignatura} @ cuat ${o+1}`);const M=(((D=u[3])==null?void 0:D.textContent)||"").replace(/\n/g,",").split(",").map(s=>s.trim()).filter(s=>s!=="");for(let s=0;s<M.length;s++){const f=M[s];f.length<8?q.push(f):v.push(f)}B.push(e)}r.cuats.push(B)}return r}export{j as default,O as extractPensum,R as legactExtractPensum};
